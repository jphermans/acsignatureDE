<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Atlas Copco E-Mail-Signaturgenerator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: light;
      --font-family: "Inter", "Segoe UI", Tahoma, Geneva, sans-serif;
      --background: #f4f7fb;
      --surface: #ffffff;
      --surface-soft: rgba(255, 255, 255, 0.7);
      --text-primary: #1f2933;
      --text-secondary: #4b5563;
      --accent: #0092bc;
      --accent-strong: #006a86;
      --accent-soft: rgba(0, 146, 188, 0.12);
      --border: rgba(15, 23, 42, 0.08);
      --border-strong: rgba(15, 23, 42, 0.18);
      --input-bg: rgba(255, 255, 255, 0.9);
      --input-border: rgba(15, 23, 42, 0.15);
      --shadow: 0 20px 45px -25px rgba(15, 23, 42, 0.4);
      --shadow-soft: 0 18px 35px -28px rgba(15, 23, 42, 0.3);
      --error-color: #d1434b;
      --background-gradient: linear-gradient(135deg, rgba(0, 146, 188, 0.18), rgba(15, 23, 42, 0.05));
    }

    body[data-theme="dark"] {
      color-scheme: dark;
      --background: #0f172a;
      --surface: rgba(15, 23, 42, 0.92);
      --surface-soft: rgba(15, 23, 42, 0.7);
      --text-primary: #f8fafc;
      --text-secondary: #cbd5f5;
      --accent: #4cc9f0;
      --accent-strong: #38a8cc;
      --accent-soft: rgba(76, 201, 240, 0.14);
      --border: rgba(148, 163, 184, 0.2);
      --border-strong: rgba(148, 163, 184, 0.35);
      --input-bg: rgba(15, 23, 42, 0.8);
      --input-border: rgba(148, 163, 184, 0.35);
      --shadow: 0 20px 45px -25px rgba(0, 0, 0, 0.65);
      --shadow-soft: 0 18px 35px -28px rgba(0, 0, 0, 0.5);
      --background-gradient: linear-gradient(135deg, rgba(76, 201, 240, 0.22), rgba(15, 23, 42, 0.82));
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-family);
      margin: 0;
      color: var(--text-primary);
      background: var(--background);
      min-height: 100vh;
      transition: background 0.4s ease, color 0.3s ease;
      position: relative;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: var(--background-gradient);
      z-index: 0;
      pointer-events: none;
      transition: background 0.4s ease;
    }

    .page {
      position: relative;
      z-index: 1;
      max-width: 1120px;
      margin: 0 auto;
      width: 100%;
      padding: clamp(32px, 6vw, 64px) clamp(18px, 6vw, 32px) clamp(56px, 8vw, 80px);
      display: flex;
      flex-direction: column;
      gap: clamp(24px, 6vw, 40px);
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      row-gap: 12px;
    }

    .country-badge {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 14px;
      border-radius: 999px;
      background: var(--surface);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      white-space: nowrap;
    }

    .country-badge .flag-icon {
      display: grid;
      grid-template-rows: repeat(3, 1fr);
      width: 20px;
      height: 14px;
      border-radius: 3px;
      overflow: hidden;
    }

    .country-badge .flag-icon span {
      display: block;
    }

    .country-badge .flag-icon span:nth-child(1) {
      background: #000000;
    }

    .country-badge .flag-icon span:nth-child(2) {
      background: #dd0000;
    }

    .country-badge .flag-icon span:nth-child(3) {
      background: #ffce00;
    }

    body[data-theme="dark"] .country-badge {
      background: var(--surface-soft);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .brand-mark {
      width: 48px;
      height: 48px;
      border-radius: 16px;
      background: var(--accent-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent);
      font-weight: 700;
      font-size: 18px;
      letter-spacing: 0.05em;
      box-shadow: var(--shadow-soft);
    }

    .brand-copy {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-copy .eyebrow {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--accent-strong);
    }

    .brand-copy .brand-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .hero {
      display: grid;
      gap: 12px;
      max-width: 720px;
    }

    .hero h1 {
      margin: 0;
      font-size: clamp(30px, 4vw, 40px);
      line-height: 1.1;
      font-weight: 700;
    }

    .hero p {
      margin: 0;
      font-size: 16px;
      color: var(--text-secondary);
      max-width: 600px;
    }

    .layout {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: clamp(20px, 4vw, 32px);
      align-items: stretch;
    }

    .card {
      background: var(--surface);
      border-radius: 24px;
      padding: clamp(24px, 4vw, 36px);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      transition: background 0.4s ease, border 0.3s ease, box-shadow 0.4s ease;
    }

    .card h2 {
      margin-top: 0;
      margin-bottom: 24px;
      font-size: 22px;
      font-weight: 600;
    }

    .form-grid {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
    }

    input {
      width: 100%;
      padding: 12px 14px;
      font-size: 15px;
      border-radius: 14px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-primary);
      transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    input::placeholder {
      color: rgba(99, 110, 133, 0.65);
    }

    input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    input.error {
      border-color: var(--error-color);
      box-shadow: 0 0 0 3px rgba(209, 67, 75, 0.12);
      background: rgba(209, 67, 75, 0.08);
    }

    .error-message {
      color: var(--error-color);
      font-size: 13px;
      display: none;
    }

    .actions {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    button {
      border: none;
      cursor: pointer;
      font-family: var(--font-family);
      font-weight: 600;
      border-radius: 999px;
      padding: 12px 24px;
      font-size: 15px;
      transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.3s ease, color 0.3s ease;
    }

    button.primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 12px 20px -12px rgba(0, 146, 188, 0.8);
    }

    button.primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 30px -15px rgba(0, 146, 188, 0.7);
      background: var(--accent-strong);
    }

    button.secondary {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
    }

    button.secondary:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px -18px rgba(0, 146, 188, 0.45);
      background: var(--accent-soft);
    }

    button.tertiary {
      background: var(--surface-soft);
      color: var(--text-secondary);
      border: 1px solid var(--border-strong);
    }

    button.tertiary:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px -18px rgba(15, 23, 42, 0.35);
      background: rgba(15, 23, 42, 0.04);
      color: var(--text-primary);
    }

    .ghost-button {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 18px;
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      background: var(--surface-soft);
      color: var(--text-primary);
      backdrop-filter: blur(12px);
      font-size: 14px;
    }

    .ghost-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 30px -18px rgba(15, 23, 42, 0.35);
    }

    .ghost-button .icon {
      font-size: 16px;
    }

    .preview-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 18px;
    }

    .preview-header p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .signature-preview {
      border-radius: 18px;
      border: 1px dashed var(--border-strong);
      background: rgba(148, 163, 184, 0.08);
      padding: 24px;
      min-height: 220px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: auto;
      transition: border 0.3s ease, background 0.3s ease;
    }

    body[data-theme="dark"] .signature-preview {
      background: rgba(148, 163, 184, 0.12);
      border-color: rgba(148, 163, 184, 0.35);
    }

    #signature {
      width: 100%;
      max-width: 100%;
    }

    #signature.has-content {
      background: #fff;
      padding: 16px;
      border-radius: 14px;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.08);
    }

    body[data-theme="dark"] #signature.has-content {
      background: rgba(15, 23, 42, 0.95);
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.22);
    }

    .signature-placeholder {
      margin: 0;
      text-align: center;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .preview-privacy-note {
      color: var(--text-secondary);
      font-style: italic;
    }

    #instructions {
      display: grid;
      gap: 18px;
    }

    .instructions-card {
      display: grid;
      gap: clamp(14px, 3vw, 22px);
    }

    .instructions-card > p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 15px;
    }

    #instructions h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    #instructions ol {
      margin: 0;
      padding-left: clamp(18px, 3vw, 28px);
      display: grid;
      gap: 12px;
    }

    #instructions li {
      color: var(--text-secondary);
      line-height: 1.6;
      display: grid;
      gap: 6px;
    }

    #instructions code, #instructions pre {
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      background: rgba(15, 23, 42, 0.07);
      padding: 4px 8px;
      border-radius: 8px;
      color: var(--text-primary);
      max-width: 100%;
      word-break: break-word;
      overflow-wrap: anywhere;
    }

    body[data-theme="dark"] #instructions code,
    body[data-theme="dark"] #instructions pre {
      background: rgba(76, 201, 240, 0.12);
    }

    #instructions pre {
      margin: 12px 0;
      white-space: pre-wrap;
      padding: 10px 12px;
      border-radius: 12px;
      overflow-x: auto;
    }

    footer {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--text-secondary);
      padding-top: 12px;
      border-top: 1px solid var(--border);
      flex-wrap: wrap;
      row-gap: 8px;
    }

    footer svg {
      width: 18px;
      height: 18px;
      fill: var(--text-secondary);
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 960px) {
      .page {
        padding: clamp(28px, 8vw, 48px) clamp(16px, 6vw, 28px) clamp(48px, 10vw, 64px);
        gap: clamp(24px, 8vw, 36px);
      }

      .actions {
        justify-content: flex-start;
      }
    }

    @media (max-width: 768px) {
      .topbar {
        flex-direction: column;
        align-items: stretch;
      }

      .brand {
        width: 100%;
        justify-content: space-between;
        align-items: center;
      }

      #theme-toggle {
        width: 100%;
        justify-content: center;
      }

      .hero {
        text-align: left;
      }

      .hero p {
        font-size: 15px;
      }
    }

    @media (max-width: 640px) {
      .brand-mark {
        width: 44px;
        height: 44px;
      }

      button {
        width: 100%;
        justify-content: center;
      }

      .actions {
        flex-direction: column;
      }

      .ghost-button {
        width: auto;
      }

      #instructions ol {
        padding-left: 18px;
      }

      #instructions pre {
        font-size: 13px;
      }
    }

    @media (max-width: 480px) {
      .brand {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .hero h1 {
        font-size: clamp(26px, 8vw, 32px);
      }

      .instructions-card {
        gap: 16px;
      }

      #instructions li {
        font-size: 14px;
      }

      footer {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body data-theme="light">
  <div class="page">
    <header class="topbar">
      <div class="brand">
        <div class="brand-mark">AC</div>
        <div class="brand-copy">
          <span class="eyebrow">Atlas Copco Tools</span>
          <span class="brand-title">Signaturgenerator</span>
        </div>
      </div>
      <div class="country-badge" aria-label="Speziell für deutsche Nutzer:innen">
        <span class="flag-icon" aria-hidden="true"><span></span><span></span><span></span></span>
        <span>Für Deutschland</span>
      </div>
      <button id="theme-toggle" class="ghost-button" type="button" aria-pressed="false">
        <span class="icon" aria-hidden="true">🌙</span>
        <span class="label">Dunkler Modus</span>
      </button>
    </header>

    <section class="hero">
      <h1>Erstelle eine professionelle Atlas Copco E-Mail-Signatur</h1>
      <p>Speziell für unsere deutschen Kolleg:innen: Trage deine Daten ein, erstelle die Vorschau und lade alles als Paket für eine schnelle Implementierung in Outlook herunter.</p>
    </section>

    <main class="layout">
      <section class="card form-card">
        <h2>Daten</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" placeholder="Zum Beispiel: Jan Janssens" required>
            <div id="error-name" class="error-message">Name ist erforderlich</div>
          </div>

          <div class="form-group">
            <label for="title">Funktion</label>
            <input type="text" id="title" placeholder="Zum Beispiel: Sales Engineer" required>
            <div id="error-title" class="error-message">Funktion ist erforderlich</div>
          </div>

          <div class="form-group">
            <label for="email">E-Mail</label>
            <input type="email" id="email" placeholder="name@atlascopco.com" required>
            <div id="error-email" class="error-message">E-Mail ist erforderlich und muss auf @atlascopco.com enden</div>
          </div>

          <div class="form-group">
            <label for="mobile">Mobil (erforderlich)</label>
            <input type="text" id="mobile" placeholder="0151 2345678 oder +49 151 2345678" required>
            <div id="error-mobile" class="error-message">Mobilnummer ist erforderlich</div>
          </div>

          <div class="form-group">
            <label for="phone">Telefon (optional)</label>
            <input type="text" id="phone" placeholder="Festnetznummer, z. B. 030 1234567 oder +49 30 1234567">
          </div>
        </div>
        <div class="actions">
          <button class="primary" type="button" onclick="generateSignature()">Signatur erstellen</button>
          <button class="secondary" type="button" onclick="exportAll()">Nach Outlook exportieren (ZIP)</button>
          <button class="secondary" type="button" onclick="clearForm()">Felder zurücksetzen</button>
        </div>
      </section>

      <section class="card preview-card">
        <div class="preview-header">
          <h2>Vorschau</h2>
          <p>Sieh dir die Signatur so an, wie sie deine Kolleg:innen erhalten.</p>
        </div>
        <div class="signature-preview">
          <div id="signature" class="signature-canvas">
            <p class="signature-placeholder">Gib deine Daten ein und klicke auf <strong>Signatur erstellen</strong>, um hier eine Vorschau zu sehen.</p>
          </div>
        </div>
      </section>
    </main>

    <section class="card instructions-card" id="instructions">
      <h3>Outlook-Implementierung</h3>
      <p><strong>Schritt-für-Schritt-Anleitung:</strong></p>
      <ol>
        <li>Klicke auf <strong>Nach Outlook exportieren (ZIP)</strong>. Es wird eine ZIP-Datei mit allen benötigten Dateien heruntergeladen.</li>
        <li>Öffne die ZIP-Datei und entpacke den Inhalt.</li>
        <li>Öffne den Ordner <code>%appdata%\Microsoft\Signatures</code> im Windows-Explorer.</li>
        <li>Kopiere die Dateien und den Ordner aus der ZIP in diesen Signatures-Ordner. Beispielstruktur:
          <pre>AtlasCopco(john.doe@atlascopco.com).htm
AtlasCopco(john.doe@atlascopco.com).rtf
AtlasCopco(john.doe@atlascopco.com).txt
AtlasCopco(john.doe@atlascopco.com)_files\</pre>
        </li>
        <li>Schließe Outlook vollständig (ggf. auch über den Task-Manager) und starte es neu.</li>
        <li>Gehe zu <strong>Datei → Optionen → E-Mail → Signaturen</strong> und wähle die neue Signatur als Standard.</li>
      </ol>
    </section>

    <footer>
      <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82A7.62 7.62 0 0 1 8 4.8c.68.01 1.36.09 2 .26 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8z" />
      </svg>
        <a href="https://github.com/jphermans/acsignatureDE" target="_blank" rel="noopener">Entwickelt von JPHsystems © 2025</a>
    </footer>
  </div>

  <script>
    const signaturePreview = document.getElementById('signature');
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = themeToggle.querySelector('.icon');
    const themeLabel = themeToggle.querySelector('.label');
    const signaturePlaceholder = signaturePreview.innerHTML;
    const mobileErrorMessage = document.getElementById('error-mobile');
    const defaultMobileErrorText = mobileErrorMessage.textContent;

    let htmlSignature = "";
    let txtSignature = "";
    let rtfSignature = "";

    function escapeHtml(value) {
      return value
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function escapeRtf(value) {
      return value
        .replace(/\\/g, "\\\\")
        .replace(/{/g, "\\{")
        .replace(/}/g, "\\}");
    }

    function sanitizeTel(value) {
      return value.replace(/[^+0-9]/g, '');
    }

    function sanitizeFileSegment(value) {
      return value.replace(/[^a-zA-Z0-9@._+-]/g, '_');
    }

    function clearErrors() {
      document.querySelectorAll('input').forEach(input => input.classList.remove('error'));
      document.querySelectorAll('.error-message').forEach(msg => msg.style.display = 'none');
      mobileErrorMessage.textContent = defaultMobileErrorText;
    }

    function clearForm() {
      document.querySelectorAll('input').forEach(input => {
        input.value = '';
      });
      clearErrors();
      htmlSignature = "";
      txtSignature = "";
      rtfSignature = "";
      signaturePreview.classList.remove('has-content');
      signaturePreview.innerHTML = signaturePlaceholder;
    }

    function isValidGermanMobile(number) {
      const clean = number.replace(/[\s\-]/g, "");
      const nationalPattern = /^01[5-7]\d{7,8}$/;
      const intlPattern = /^\+49(1[5-7]\d{8,9})$/;
      return nationalPattern.test(clean) || intlPattern.test(clean);
    }

    function generateSignature() {
      clearErrors();

      const name = document.getElementById('name').value.trim();
      const title = document.getElementById('title').value.trim();
      const email = document.getElementById('email').value.trim();
      const mobile = document.getElementById('mobile').value.trim();
      const phone = document.getElementById('phone').value.trim();

      let valid = true;

      if (!name) { showError('name'); valid = false; }
      if (!title) { showError('title'); valid = false; }
      if (!email || !email.toLowerCase().endsWith('@atlascopco.com')) { showError('email'); valid = false; }
      if (!mobile || !isValidGermanMobile(mobile)) {
        mobileErrorMessage.textContent = 'Bitte gib eine gültige deutsche Mobilnummer an (01… oder +49 1…)';
        showError('mobile');
        valid = false;
      }

      if (!valid) return;

      let contactInfoHtml = "";
      let contactInfoText = "";

      const safeName = escapeHtml(name);
      const safeTitle = escapeHtml(title);
      const safeEmail = escapeHtml(email);
      const safeMobile = escapeHtml(mobile);
      const safePhone = escapeHtml(phone);
      const telMobile = sanitizeTel(mobile);
      const telPhone = sanitizeTel(phone);

      if (phone !== "") {
        contactInfoHtml += `<div style="font-size:9pt;color:#2F363A;">Phone: <a href="tel:${telPhone}" style="color:#2F363A;text-decoration:none;">${safePhone}</a> - Mobile: <a href="tel:${telMobile}" style="color:#2F363A;text-decoration:none;">${safeMobile}</a></div>`;
        contactInfoText += `Phone: ${phone} - Mobile: ${mobile}\n`;
      } else {
        contactInfoHtml += `<div style="font-size:9pt;color:#2F363A;">Mobile: <a href="tel:${telMobile}" style="color:#2F363A;text-decoration:none;">${safeMobile}</a></div>`;
        contactInfoText += `Mobile: ${mobile}\n`;
      }

      contactInfoHtml += `<div style="font-size:9pt;color:#2F363A;">Email: <a href="mailto:${safeEmail}" style="color:#0092BC;text-decoration:none;">${safeEmail}</a></div>`;
      contactInfoText += `Email: ${email}\n`;

      htmlSignature = `
<html><head><meta charset="UTF-8"></head><body>
<div style="font-family:Calibri,Arial,sans-serif; font-size:9pt; color:#2F363A; line-height:1.4; max-width:600px;">
  <div>Best regards / Mit freundlichen Grüßen,</div>
  <div style="margin-top:4px; font-weight:bold;">i.A. <span style="color:#0092BC;">${safeName}</span></div>
  <div style="font-weight:bold; font-size:9pt; margin-top:2px;">${safeTitle}</div>

  <div style="margin-top:12px; font-weight:bold; font-size:10pt;">Atlas Copco Tools Central Europe GmbH</div>
  <div>Address: Langemarckstr. 35, D-45141 Essen</div>
  <div style="color:#d1434b; font-weight:bold;">We're moving! New Visitor Address as of Dec 1, 2025: Wetterschacht 9, D-45139 Essen</div>
  <div>Postal Address: 10 02 04, D-45002 Essen</div>
  <div>Managing Director: Claus Schiedeck, Peter Edmonds</div>

  <div style="margin-top:6px;">${contactInfoHtml}</div>

  <div style="margin-top:6px;">VAT Reg. No.: DE811155641</div>
  <div>Company Reg. No.: HRB 5096 – Local Court Essen</div>
  <div>Registered Office: Atlas Copco Tools Central Europe GmbH</div>

  <div style="margin-top:6px;">Privacy policy: <a href="https://www.atlascopco.com/de-de/itba/datenschutzerklarung" target="_blank" style="color:#0092BC;text-decoration:none;">https://www.atlascopco.com/de-de/itba/datenschutzerklarung</a></div>

  <div style="margin-top:6px;"><b style="color:#0092BC;">Leave your feedback at</b> <a href="https://www.atlascopco.com" target="_blank" style="color:#0092BC; font-style:italic; text-decoration:none;">atlascopco.com</a></div>

  <div style="margin-top:10px;">
    <table cellpadding="0" cellspacing="0" border="0">
      <tr>
        <td><img src="https://groupapp.atlascopco.com/mail-signature/Signature/AtlasCopco/ACBlueSquare.png" width="8" height="8" style="display:block;"></td>
        <td style="padding-left:5px;">
          <span style="font-size:8pt; color:#A1A9B4; font-weight:bold;">Teil der Atlas Copco Gruppe</span>
        </td>
      </tr>
    </table>
  </div>
</body></html>`;

      txtSignature = `Best regards / Mit freundlichen Grüßen,
i.A. ${name}
${title}

Atlas Copco Tools Central Europe GmbH
Address: Langemarckstr. 35, D-45141 Essen
We're moving! New Visitor Address as of Dec 1, 2025: Wetterschacht 9, D-45139 Essen
Postal Address: 10 02 04, D-45002 Essen
Managing Director: Claus Schiedeck, Peter Edmonds

${contactInfoText}
VAT Reg. No.: DE811155641
Company Reg. No.: HRB 5096 – Local Court Essen
Registered Office: Atlas Copco Tools Central Europe GmbH

Privacy policy: https://www.atlascopco.com/de-de/itba/datenschutzerklarung
Leave your feedback at atlascopco.com

Part of the Atlas Copco Group
`;

      rtfSignature = `{\rtf1\ansi\deff0
{\fonttbl{\f0 Calibri;}}
\f0\fs18 Best regards / Mit freundlichen Gr\'fc\'dfen,\line
\b i.A. ${escapeRtf(name)}\b0\line
${escapeRtf(title)}\line
\line
Atlas Copco Tools Central Europe GmbH\line
Address: Langemarckstr. 35, D-45141 Essen\line
We're moving! New Visitor Address as of Dec 1, 2025: Wetterschacht 9, D-45139 Essen\line
Postal Address: 10 02 04, D-45002 Essen\line
Managing Director: Claus Schiedeck, Peter Edmonds\line
\line
${escapeRtf(contactInfoText).replace(/\n/g, "\line ")}\line
VAT Reg. No.: DE811155641\line
Company Reg. No.: HRB 5096 – Local Court Essen\line
Registered Office: Atlas Copco Tools Central Europe GmbH\line
\line
Privacy policy: https://www.atlascopco.com/de-de/itba/datenschutzerklarung\line
Leave your feedback at atlascopco.com\line
\line
Part of the Atlas Copco Group
}`;

      signaturePreview.classList.add('has-content');
      signaturePreview.innerHTML = htmlSignature;
      maskManagingDirectorInPreview(signaturePreview);
    }

    function maskManagingDirectorInPreview(container) {
      const managingDirectorLabels = ['Managing Director:', 'Geschäftsführung:'];
      const managingDirectorElement = Array.from(container.querySelectorAll('div')).find(div =>
        managingDirectorLabels.some(label => div.textContent.trim().startsWith(label))
      );

      if (managingDirectorElement) {
        const label = managingDirectorLabels.find(l => managingDirectorElement.textContent.trim().startsWith(l)) || managingDirectorLabels[0];
        managingDirectorElement.innerHTML = `${label} <span class="preview-privacy-note">[In der Vorschau ausgeblendet]</span>`;
      }
    }

    function showError(field) {
      document.getElementById(field).classList.add('error');
      document.getElementById('error-' + field).style.display = 'block';
    }

    function exportAll() {
      if (!htmlSignature) {
        alert('Bitte erstelle zunächst eine Signatur!');
        return;
      }
      const email = document.getElementById('email').value.trim();
      const baseName = 'AtlasCopco(' + sanitizeFileSegment(email) + ')';

      const zip = new JSZip();
      zip.file(baseName + '.htm', htmlSignature);
      zip.file(baseName + '.txt', txtSignature);
      zip.file(baseName + '.rtf', rtfSignature);
      zip.folder(baseName + '_files');

      zip.generateAsync({ type: 'blob' }).then(function(content) {
        saveAs(content, baseName + '.zip');
      });
    }

    function applyTheme(theme) {
      document.body.setAttribute('data-theme', theme);
      themeToggle.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
      if (theme === 'dark') {
        themeIcon.textContent = '☀️';
        themeLabel.textContent = 'Heller Modus';
      } else {
        themeIcon.textContent = '🌙';
        themeLabel.textContent = 'Dunkler Modus';
      }
    }

    function detectPreferredTheme() {
      const stored = localStorage.getItem('acsignature-theme');
      if (stored === 'light' || stored === 'dark') {
        return stored;
      }
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    applyTheme(detectPreferredTheme());

    themeToggle.addEventListener('click', () => {
      const currentTheme = document.body.getAttribute('data-theme');
      const nextTheme = currentTheme === 'dark' ? 'light' : 'dark';
      localStorage.setItem('acsignature-theme', nextTheme);
      applyTheme(nextTheme);
    });

    const handleSystemThemeChange = event => {
      if (!localStorage.getItem('acsignature-theme')) {
        applyTheme(event.matches ? 'dark' : 'light');
      }
    };

    if (prefersDark.addEventListener) {
      prefersDark.addEventListener('change', handleSystemThemeChange);
    } else if (prefersDark.addListener) {
      prefersDark.addListener(handleSystemThemeChange);
    }
  </script>
</body>
</html>
